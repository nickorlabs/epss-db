#!/bin/bash

# update-exploits.sh - Main script for updating exploit data
# Using dynamic path detection for portability
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
BASEPATH="$SCRIPT_DIR"

echo "=== Updating Exploit Data ==="
echo "Using base path: $BASEPATH"

# Check if exploit tables exist, if not initialize them
if ! mysql --defaults-file="$BASEPATH/my.cnf" -e "SHOW TABLES LIKE 'exploits'" | grep -q "exploits"; then
  echo "Exploit tables not found. Initializing..."
  "$BASEPATH/init-script/exploit-init.sh"
fi

# Run the source-specific update scripts
echo "Updating from ExploitDB..."
"$BASEPATH/subprogram/exploits/exploitdb-update.sh"

echo "Updating from Packet Storm..."
"$BASEPATH/subprogram/exploits/packetstorm-update.sh"

# Future sources will be added here as they are implemented
# echo "Updating from Metasploit..."
# "$BASEPATH/subprogram/exploits/metasploit-update.sh"
# 
# echo "Updating from GitHub exploits..."
# "$BASEPATH/subprogram/exploits/github-update.sh"
#
# echo "Updating from Nuclei templates..."
# "$BASEPATH/subprogram/exploits/nuclei-update.sh"

echo "=== Exploit Data Update Completed ==="
