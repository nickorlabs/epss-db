-- Schema for MITRE CVE table (separate from NVD)
CREATE TABLE IF NOT EXISTS mitre_cve (
    cve_id TEXT PRIMARY KEY,
    year INT,
    state TEXT,
    assigner TEXT,
    published DATE,
    last_modified DATE,
    description TEXT,
    "references" TEXT[],
    json_data JSONB
);

ALTER TABLE mitre_cve
  ADD COLUMN IF NOT EXISTS cvss2_version TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_vector TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_score FLOAT,
  ADD COLUMN IF NOT EXISTS cvss2_av TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_ac TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_au TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_c TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_i TEXT,
  ADD COLUMN IF NOT EXISTS cvss2_a TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_version TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_vector TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_score FLOAT,
  ADD COLUMN IF NOT EXISTS cvss3_av TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_ac TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_pr TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_ui TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_s TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_c TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_i TEXT,
  ADD COLUMN IF NOT EXISTS cvss3_a TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_version TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_vector TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_score FLOAT,
  ADD COLUMN IF NOT EXISTS cvss4_av TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_ac TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_at TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_pr TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_ui TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_v TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_c TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_i TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_a TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_s TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_si TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_sc TEXT,
  ADD COLUMN IF NOT EXISTS cvss4_sa TEXT;

CREATE INDEX IF NOT EXISTS idx_mitre_cve_year ON mitre_cve(year);
CREATE INDEX IF NOT EXISTS idx_mitre_cve_last_modified ON mitre_cve(last_modified);
